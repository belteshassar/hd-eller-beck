<div id="rules">
    <h1>Beck-film eller rättsfall från Högsta domstolen</h1>
    <p>Sedan några år tillbaka namnger Högsta domstolen de flesta av de mål som den avgör.
    Namnen för ibland tankarna till kriminalromaner eller -filmer. Klarar du att skilja på de två?
    Du kommer att få se tio titlar och din uppgift är att avgöra om titeln tillhör en Beck-film eller
    ett rättsfall från Högsta domstolen. <!--eller kanske båda, men det finns inget sådant exempel när detta skrivs--></p>
</div>
<div id="quiz"></div>
<div id="results">
  <div id="message"></div>
  <div id="info"></div>
  <div id="link"></div>
</div>
<div id="cRetry"></div>

<script>

class SPARQLQueryDispatcher {
  constructor( endpoint ) {
    this.endpoint = endpoint;
  }

  query( sparqlQuery ) {
    const fullUrl = this.endpoint + '?query=' + encodeURIComponent( sparqlQuery );
    const headers = { 'Accept': 'application/sparql-results+json' };

    return fetch( fullUrl, { headers } ).then( body => body.json() );
  }
}

const endpointUrl = 'https://query.wikidata.org/sparql';
const beckQuery = `SELECT ?title (YEAR(?date) AS ?year) ?regiLabel ?beckLabel ?article WHERE {
  ?item wdt:P179 wd:Q16939437;
        wdt:P1476 ?title;
        wdt:P577 ?date;
        wdt:P57 ?regi;
        p:P161 [ps:P161 ?beck; pq:P453 wd:Q13652117].
  ?article schema:about ?item;
           schema:isPartOf <https://sv.wikipedia.org/>.
  SERVICE wikibase:label { bd:serviceParam wikibase:language "sv,en,de". }
}`;
const hdQuery = `SELECT ?title ?nja (YEAR(?date) AS ?year) ?url WHERE {
  ?item wdt:P31 wd:Q96482904;
        wdt:P1476 ?title;
        wdt:P1031 ?nja;
        wdt:P577 ?date.
  OPTIONAL {?item wdt:P953 ?url.}
}`;

const queryDispatcher = new SPARQLQueryDispatcher( endpointUrl );
queryDispatcher.query( beckQuery ).then( console.log );
queryDispatcher.query( hdQuery ).then( console.log );


const correctMessage = 'Grattis, du svarade rätt.';
const wrongMessage = 'Tyvärr, du svarade fel.';

const quizContainer = document.getElementById('quiz');
const resultsContainer = document.getElementById('results');
const rulesContainer = document.getElementById('rules');
const messageContainer = document.getElementById('message');
const infoContainer = document.getElementById('info');
const linkContainer = document.getElementById('link');
const retryContainer = document.getElementById('cRetry');

// hide elements for later use

const myQuestions = [
  {
    question: "Kartellen",
    answers: {
      a: "Rättsfall",
      b: "Beck-film"
    },
    correctAnswer: "b"
  },
  {
    question: "Ishavet",
    answers: {
        a: "Rättsfall",
        b: "Beck-film"
    },
    correctAnswer: "a"
  },
  {
    question: "Royal",
    answers: {
        a: "Rättsfall",
        b: "Beck-film"
    },
    correctAnswer: "a"
  }
];

function showQuestion(){
  quizContainer.innerHTML = `<div id="title">Kartellen</div>
  <button id="beck">Beck-film</button> eller <button id="hd">rättsfall</button> ?`;
  const hdButton = document.getElementById('hd');
  const beckButton = document.getElementById('beck');
  hdButton.addEventListener('click', displayWrongMessage);
  beckButton.addEventListener('click', displayCorrectMessage);
}

function hideQuestion(){
  quizContainer.innerHTML = '';
}

function displayCorrectMessage(){
  messageContainer.innerHTML = correctMessage;
  displayTitleInfo();
  retryContainer.innerHTML = '<button id="retry">Försök igen</button>';
  document.getElementById('retry').addEventListener('click', hideResults);
}

function displayWrongMessage(){
  messageContainer.innerHTML = wrongMessage;
  displayTitleInfo();
  retryContainer.innerHTML = '<button id="retry">Försök igen</button>';
  document.getElementById('retry').addEventListener('click', hideResults);
}

function displayTitleInfo(){
  infoContainer.innerHTML = '<p><b><i>Kartellen</i></b> är en film från 2001 av Kjell Sundvall med Peter Haber i rollen som Martin Beck.</p>';
  linkContainer.innerHTML = '<a href="https://sv.wikipedia.org/wiki/Beck_%E2%80%93_Kartellen">Läs mer på Wikipedia.</a>';
}

function hideResults(){
  messageContainer.innerHTML = '';
  infoContainer.innerHTML = '';
  linkContainer.innerHTML = '';
  retryContainer.innerHTML = '';
}

showQuestion();

// Fetch and process data from Wikidata.
// To be created, for now use the const above.
// Build question and add answer buttons
// on submit, compare to answer key and display message

</script>
